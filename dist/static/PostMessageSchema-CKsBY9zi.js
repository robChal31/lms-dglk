import{r as A,b as h,ai as D,cU as U,a4 as q,cI as V,an as C,cJ as L,ap as B,cV as W,j as S,cW as Y,cX as J,cY as K}from"./sanity-I2A2J8WM.js";function X(n){const{validation:e}=n.type;if(!e)return!1;const r=Array.isArray(e)?e:[e];for(const i of r){let c=!1;const f=new Proxy({},{get:(g,y)=>()=>(y==="required"&&(c=!0),f)});if(typeof i=="function"&&(i(f),c)||typeof i=="object"&&i!==null&&"_required"in i&&i._required==="required")return!0}return!1}function _(n,e){let r=n;for(;r;){if(r.name===e||r.type&&r.type.name===e)return!0;r=r.type}return!1}function z(n){return _(n,"object")||n.jsonType==="object"||"fields"in n}function G(n){return _(n,"array")}function x(n){return _(n,"reference")}function H(n){return _(n,"crossDatasetReference")}function Q(n){return _(n,"string")}function Z(n){return _(n,"number")}function I(n){let e=n;for(;e;){if(!e.type)return e;e=e.type}}function R(n){return"fields"in n?n.type?R(n.type).concat(n.fields):n.fields:[]}function T(n){const e=new Set;function r(o,u){if(!e.has(o)){if(e.add(o),"fields"in o)for(const l of R(o)){const t=I(l.type);if(t.name==="document"){u.add(t);continue}let s;o.type.type?s=l.type.type.name:"jsonType"in o.type&&(s=l.type.jsonType),(s==="object"||s==="block")&&(x(l.type)?l.type.to.forEach(a=>u.add(a.type)):u.add(l.type)),r(l.type,u)}else if("of"in o)for(const l of o.of)r(l,u)}}const i=new Map;n.getTypeNames().forEach(o=>{const u=n.get(o);if(u===void 0||u.type===null)return;const l=new Set;r(u,l),i.set(u,l),e.clear()});const c=[],f=new Set,g=new Set;function y(o){if(g.has(o)||f.has(o))return;f.add(o);const u=i.get(o);u!==void 0&&u.forEach(l=>y(l)),f.delete(o),g.add(o),c.includes(o.name)||c.unshift(o.name)}for(const[o]of i)y(o);return c}const ee=function(n){const e=h.c(6),{schemaType:r,theme:i}=n,{theme:c,scheme:f,tone:g}=i;let y;e[0]===Symbol.for("react.memo_cache_sentinel")?(y=new Y,e[0]=y):y=e[0];const o=y,u=r.icon;let l;return e[1]!==u||e[2]!==f||e[3]!==c||e[4]!==g?(l=u?S.jsx(J,{sheet:o.instance,children:S.jsx(K,{theme:c,scheme:f,tone:g,children:A.isValidElement(u)?u:S.jsx(u,{})})}):null,e[1]=u,e[2]=f,e[3]=c,e[4]=g,e[5]=l):l=e[5],l},te=n=>({_id:{type:"objectField",name:"_id",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:n}},_createdAt:{type:"objectField",name:"_createdAt",value:{type:"string"}},_updatedAt:{type:"objectField",name:"_updatedAt",value:{type:"string"}},_rev:{type:"objectField",name:"_rev",value:{type:"string"}}});function ne(n){var r;const e=(r=n.options)==null?void 0:r.list;return e&&Array.isArray(e)?{type:"union",of:e.map(i=>({type:"string",value:typeof i=="string"?i:i.value}))}:{type:"string"}}function re(n){var r;const e=(r=n.options)==null?void 0:r.list;return e&&Array.isArray(e)?{type:"union",of:e.map(i=>({type:"number",value:typeof i=="number"?i:i.value}))}:{type:"number"}}function F(n,e=!1){const r={_ref:{type:"objectField",name:"_ref",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:"reference"}},_weak:{type:"objectField",name:"_weak",value:{type:"boolean"},optional:!0}};return e&&(r._key={type:"objectField",name:"_key",value:{type:"string"}}),{type:"object",fields:r,dereferencesTo:n}}function ie(n){const e=oe(n);return e.length===1?F(e[0]):{type:"union",of:e.map(r=>({type:"unionOption",name:r,value:F(r)}))}}function oe(n){const e=N(n);return[...new Set([...e.map(r=>r.name)])]}function N(n){const e="to"in n?n.to:[];return"type"in n&&x(n.type)?[...N(n.type),...e]:e}const E=new Map([["text",{type:"string"}],["url",{type:"string"}],["datetime",{type:"string"}],["date",{type:"string"}],["boolean",{type:"boolean"}],["email",{type:"string"}]]);function se(n,e){const r=new Set,{schema:i,basePath:c}=n;return T(i).map(t=>{const s=i.get(t);if(s===void 0)return;const a=g(s);if(a!==null)return a.type==="type"&&r.add(s),a}).filter(t=>t!==void 0);function f(t){if(t.icon)return W.renderToString(S.jsx(ee,{schemaType:t,theme:e}))}function g(t){let s;if(t.type?s=t.type.name:"jsonType"in t&&(s=t.jsonType),s==="document"){const d=y(t);return d.type==="unknown"?null:{type:"document",name:t.name,title:typeof t.title=="string"?t.title:void 0,icon:f(t),fields:{...te(t.name),...d.fields}}}const a=o(t);return a.type==="unknown"?null:a.type==="object"?{name:t.name,type:"type",value:{type:"object",fields:{_type:{type:"objectField",name:"_type",value:{type:"string",value:t.name}},...a.fields}}}:{name:t.name,title:typeof t.title=="string"?t.title:void 0,type:"type",value:a}}function y(t){const s={};for(const a of R(t)){const d=o(a.type);d!==null&&(s[a.name]={type:"objectField",name:a.name,title:typeof a.type.title=="string"?a.type.title:void 0,value:d,optional:X(a)===!1})}return{type:"object",fields:s}}function o(t){var a,d,b,p;if(((a=I(t))==null?void 0:a.name)==="document")return F(t.name);if(r.has(t.type))return{type:"inline",name:t.type.name};if(((b=(d=t.type)==null?void 0:d.type)==null?void 0:b.name)==="object")return{type:"inline",name:t.type.name};if(Q(t))return ne(t);if(Z(t))return re(t);const s=E.get(((p=t.type)==null?void 0:p.name)||"");if(s)return s;if(t.type&&E.has(t.type.name))return E.get(t.type.name);if(H(t))return{type:"unknown"};if(x(t))return ie(t);if(G(t))return l(t);if(z(t))return y(t);throw new Error(`Type "${t.name}" not found`)}function u(t,s){var b;const{options:a}=t;if(!a)return;const d={...a};return a.insertMenu&&(d.insertMenu={...a.insertMenu,views:(b=a.insertMenu.views)==null?void 0:b.map(p=>p.name==="grid"?{name:"grid",previewImageUrls:p.previewImageUrl?s.reduce((m,{name:v})=>{var w;const j=(w=p.previewImageUrl)==null?void 0:w.call(p,v);if(!j)return m;try{new URL(j),m[v]=j}catch{m[v]=new URL(j,`${window.location.origin}${c?`${c}/`:""}`).toString()}return m},{}):void 0}:p)}),d}function l(t){const s=[];for(const p of t.of){let m=o(p);const v={type:"unionOption",icon:f(p),name:p.name,title:typeof p.title=="string"?p.title:void 0,value:m};m.type==="inline"?m={type:"object",fields:{_key:k()},rest:m}:m.type==="object"&&(m.rest={type:"object",fields:{_key:k()}}),v.value=m,s.push(v)}if(s.length===0)return{type:"null"};if(s.length>1)return{type:"union",of:s,options:u(t,s)};const{name:a,title:d,value:b}=s[0];return{type:"array",of:{type:"arrayItem",name:a,title:typeof d=="string"?d:void 0,value:b}}}}function k(){return{type:"objectField",name:"_key",value:{type:"string"}}}function ae(n){const e=n.reduce((r,{id:i,path:c})=>(r[i]?r[i].add(c):r[i]=new Set([c]),r),{});return Object.entries(e)}function ue(n){const e=h.c(12),{comlink:r,perspective:i}=n,c=D(),f=U();let g,y;e[0]!==r||e[1]!==f||e[2]!==c?(g=()=>{try{const s=se(c,f);return r.post("presentation/schema",{schema:s}),r.on("visual-editing/schema",()=>({schema:s}))}catch{return}},y=[r,f,c],e[0]=r,e[1]=f,e[2]=c,e[3]=g,e[4]=y):(g=e[3],y=e[4]),A.useEffect(g,y);let o;e[5]!==i?(o=L(i)?V:{apiVersion:C},e[5]=i,e[6]=o):o=e[6];const u=q(o);let l,t;return e[7]!==u||e[8]!==r||e[9]!==i?(l=()=>r.on("visual-editing/schema-union-types",async s=>{const a=ae(s.paths),d=await Promise.all(a.map(async p=>{const[m,v]=p,j=Array.from(v),w=`*[_id == $id][0]{${j.map(ce).join(",")}}`,M=await u.fetch(w,{id:B(m)},{tag:"presentation-schema",perspective:i}),P=j.map((O,$)=>({path:O,type:M[$]}));return{id:m,paths:P}})),b=new Map;return d.forEach(p=>{b.set(p.id,new Map(p.paths.map(le)))}),{types:b}}),t=[r,u,i],e[7]=u,e[8]=r,e[9]=i,e[10]=l,e[11]=t):(l=e[10],t=e[11]),A.useEffect(l,t),null}function le(n){const{path:e,type:r}=n;return[e,r]}function ce(n,e){return`"${e}": ${n}[0]._type`}var fe=A.memo(ue);export{fe as default};
